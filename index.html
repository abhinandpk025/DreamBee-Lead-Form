<!DOCTYPE html>
<html>
<head>
  <title>Customer Booking Form</title>
  <meta charset="UTF-8" />
</head>
<body>
  <h2>Customer Booking Form</h2>

  <form id="bookingForm">
    <label>Student Name: <input name="studentName" required></label><br><br>
    <label>Parent Name: <input name="parentName" required></label><br><br>
    <label>Mobile Number: <input name="mobNumber" pattern="[0-9]{10}" required></label><br><br>

    <label>Department:
      <select name="department" required>
        <option value="">Select</option>
        <option>Mech</option>
        <option>Civil</option>
        <option>EEE</option>
        <option>ECE</option>
        <option>IC</option>
        <option>CS</option>
      </select>
    </label><br><br>

    <label>Receipt No: <input type="number" name="receiptNo" required></label><br><br>

    <label>Package Opted:
      <select id="packageDropdown" name="packageOpted" required>
        <option value="">Loading...</option>
      </select>
    </label><br><br>

    <label>Package Rate: <input type="number" name="packageRate" id="packageRate" readonly></label><br><br>

    <label>Advance Paid: <input type="number" name="advancePaid" required></label><br><br>

    <label>Mode of Payment:
      <select name="paymentMode" required>
        <option value="">Select</option>
        <option>UPI</option>
        <option>Cash</option>
      </select>
    </label><br><br>

    <label>Order Taken By: <input name="orderTakenBy" required></label><br><br>

    <label>Probable Date of Arrival: 
      <input type="date" name="arrivalDate" required>
    </label><br><br>

    <button type="submit">Submit</button>
  </form>

  <p id="responseMsg"></p>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxfThMyAht1eTNmaPfFsje55Ne5ULsQx6GrdbhYwIrOHjUnU_TNQFK2w6VVsrVyDUeH/exec'; // üëà replace with your actual Web App URL

    // Fetch dropdown values
    fetch(scriptURL)
      .then(res => res.json())
      .then(data => {
        const dropdown = document.getElementById('packageDropdown');
        dropdown.innerHTML = '<option value="">Select</option>';
        data.forEach(item => {
          const option = document.createElement('option');
          option.value = item.name;
          option.textContent = item.name;
          option.setAttribute('data-price', item.price);
          dropdown.appendChild(option);
        });
      });

    // Autofill price
    document.getElementById('packageDropdown').addEventListener('change', function () {
      const selected = this.options[this.selectedIndex];
      document.getElementById('packageRate').value = selected.getAttribute('data-price') || '';
    });

    // Submit form
    document.getElementById('bookingForm').addEventListener('submit', function (e) {
      e.preventDefault();
      const formData = new FormData(this);
      const data = {};
      formData.forEach((v, k) => data[k] = v);

      fetch(scriptURL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      })
      .then(res => res.json())
      .then(res => {
        document.getElementById('responseMsg').textContent = res.success ? '‚úÖ Submitted successfully!' : '‚ùå Failed: ' + res.error;
        if (res.success) this.reset();
      })
      .catch(err => {
        document.getElementById('responseMsg').textContent = '‚ùå Error: ' + err.message;
      });
    });
  </script>
</body>
</html>
